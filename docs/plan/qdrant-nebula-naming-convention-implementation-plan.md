# Qdrant与Nebula命名约定实施计划

## 📋 项目概述

本计划详细说明了如何修改当前Qdrant和Nebula的命名约定配置，以解决固定命名与项目隔离机制的冲突问题。

## 🎯 目标

1. **确保项目隔离机制有效性**
2. **统一Qdrant和Nebula的命名约定**
3. **保持向后兼容性**
4. **提供清晰的配置管理**

## 📅 实施时间表

**总工期**: 3.5周

### 阶段一：配置清理与基础修改（1周）
**时间**: 第1周
**负责人**: 开发团队

#### 任务清单
- [x] **修改环境配置文件** (`预计: 0.5天`)
  - 更新 `.env.example` 文件
  - 注释掉固定的 `QDRANT_COLLECTION` 和 `NEBULA_SPACE` 配置
  - 添加配置说明注释

- [ ] **更新配置服务逻辑** (`预计: 1.5天`)
  - 修改 `QdrantConfigService.ts`
  - 修改Nebula配置服务（如需要）
  - 实现配置优先级逻辑

- [ ] **基础测试** (`预计: 1天`)
  - 单元测试配置服务修改
  - 集成测试基础功能
  - 验证向后兼容性

#### 交付物
- 更新的环境配置文件
- 修改后的配置服务代码
- 测试报告

### 阶段二：命名约定统一（1周）
**时间**: 第2周
**负责人**: 开发团队

#### 任务清单
- [ ] **统一命名分隔符** (`预计: 2天`)
  - 选择统一的命名模式（推荐连字符 `-`）
  - 修改 `ProjectIdManager.ts` 中的命名生成逻辑
  - 更新相关文档

- [ ] **配置验证增强** (`预计: 1.5天`)
  - 实现命名验证规则
  - 添加配置冲突检测
  - 完善错误处理

- [ ] **集成测试** (`预计: 1天`)
  - 测试命名生成的一致性
  - 验证多项目场景
  - 性能测试

#### 交付物
- 统一的命名约定实现
- 增强的配置验证机制
- 集成测试报告

### 阶段三：高级功能与监控（1周）
**时间**: 第3周
**负责人**: 开发团队

#### 任务清单
- [ ] **健康检查机制** (`预计: 1.5天`)
  - 实现配置健康检查
  - 添加监控指标
  - 设置警报机制

- [ ] **迁移工具开发** (`预计: 1.5天`)
  - 开发配置迁移脚本
  - 创建数据迁移工具（如需要）
  - 测试迁移流程

- [ ] **性能优化** (`预计: 1天`)
  - 优化命名生成性能
  - 缓存优化
  - 内存使用优化

#### 交付物
- 健康检查实现
- 迁移工具和文档
- 性能优化报告


## 🔧 技术实施细节

### 1. 环境配置修改

**修改前:**
```bash
QDRANT_COLLECTION = code-snippets
NEBULA_SPACE = code_graphs
```

**修改后:**
```bash
# QDRANT_COLLECTION = (可选) # 显式设置将覆盖自动生成
# NEBULA_SPACE = (可选)     # 显式设置将覆盖自动生成
```
已完成

### 2. 配置服务逻辑升级

**新的配置优先级逻辑:**
```typescript
class EnhancedConfigService {
  getCollectionName(projectId: string): string {
    // 1. 检查显式环境配置
    const explicitName = this.getExplicitCollectionName();
    if (explicitName) {
      this.logger.warn('使用显式配置覆盖项目隔离命名');
      return explicitName;
    }
    
    // 2. 使用项目隔离的动态命名
    return `project-${projectId}`;
  }
}
```

### 3. 命名约定统一

**统一使用连字符模式:**
```typescript
// 统一后的命名生成
const collectionName = `project-${projectId}`;  // Qdrant
const spaceName = `project-${projectId}`;       // Nebula（统一为连字符）
```
