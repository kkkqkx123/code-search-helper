{"cells":[{"code":"#include <stdio.h>\r\n#include <stdlib.h>\r\n\r\n// 1. 基础场景：单指针参数的资源清理函数（最匹配）\r\nvoid free_buffer(char* buf) {  // 函数名free_buffer → @resource.cleanup.function；指针buf → @resource.pointer\r\n    if (buf != NULL) {\r\n        free(buf);\r\n        buf = NULL;  // 资源释放后置空\r\n    }\r\n}\r\n\r\n// 2. 不同类型指针参数（int*）\r\nvoid release_int_array(int* arr) {  // arr → @resource.pointer\r\n    free(arr);\r\n}\r\n\r\n// 3. 带const修饰的指针参数（const char*）\r\nvoid destroy_string(const char* str) {  // str → @resource.pointer（指针类型不影响匹配）\r\n    free((void*)str);\r\n}\r\n\r\n// 4. 函数体包含多语句的清理函数\r\nvoid cleanup_file(FILE* fp) {  // fp（文件指针）→ @resource.pointer\r\n    if (fp != NULL) {\r\n        fclose(fp);\r\n        printf(\"File closed successfully\\n\");\r\n    }\r\n}\r\n\r\n// 5. 指针参数为结构体指针（复杂类型）\r\ntypedef struct {\r\n    int id;\r\n    char* name;\r\n} User;\r\n\r\nvoid destroy_user(User* user) {  // user → @resource.pointer\r\n    if (user != NULL) {\r\n        free(user->name);  // 嵌套资源清理\r\n        free(user);\r\n    }\r\n}\r\n\r\n// 6. 静态清理函数（static修饰，不影响匹配）\r\nstatic void free_memory(void* ptr) {  // ptr → @resource.pointer（void* 通用指针）\r\n    free(ptr);\r\n}\r\n\r\n// 7. 有返回值的清理函数（非void返回值）\r\nint cleanup_socket(int* sock_fd) {  // sock_fd → @resource.pointer\r\n    if (*sock_fd >= 0) {\r\n        close(*sock_fd);\r\n        *sock_fd = -1;\r\n        return 0;\r\n    }\r\n    return -1;\r\n}\r\n\r\nint main() {\r\n    // 测试调用示例（非查询匹配部分，仅用于验证函数可用性）\r\n    char* buf = malloc(1024);\r\n    free_buffer(buf);\r\n\r\n    int* arr = malloc(5 * sizeof(int));\r\n    release_int_array(arr);\r\n\r\n    User* u = malloc(sizeof(User));\r\n    u->name = malloc(20);\r\n    destroy_user(u);\r\n\r\n    return 0;\r\n}","language":"cpp","kind":"code"},{"code":"(function_definition\r\n  declarator: (function_declarator\r\n    declarator: (identifier) @resource.cleanup.function\r\n    parameters: (parameter_list\r\n      (parameter_declaration\r\n        type: (type_identifier)\r\n        declarator: (pointer_declarator declarator: (identifier)) @resource.pointer)))\r\n  body: (compound_statement)\r\n  (#set! \"operation\" \"cleanup\")) @lifecycle.entity.resource.cleanup","language":"scm","kind":"code"}]}