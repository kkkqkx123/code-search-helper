{"cells":[{"code":"#include <pthread.h>\r\n#include <windows.h>\r\n\r\nvoid* thread_function(void* arg) {\r\n    return NULL;\r\n}\r\n\r\nint main() {\r\n    pthread_t thread;\r\n    pthread_attr_t attr;\r\n    \r\n    // pthread_create测试\r\n    pthread_create(&thread, &attr, thread_function, NULL);\r\n    \r\n    // CreateThread测试\r\n    HANDLE hThread = CreateThread(\r\n        NULL,                   // Security attributes\r\n        0,                      // Stack size\r\n        (LPTHREAD_START_ROUTINE)thread_function,  // Start function\r\n        NULL,                   // Argument\r\n        0,                      // Creation flags\r\n        NULL                    // Thread ID\r\n    );\r\n    \r\n    // _beginthreadex测试\r\n    HANDLE hThread2 = (HANDLE)_beginthreadex(\r\n        NULL,                   // Security\r\n        0,                      // Stack size\r\n        (LPTHREAD_START_ROUTINE)thread_function,  // Start function\r\n        NULL,                   // Argument\r\n        0,                      // Init flag\r\n        NULL                    // Thread address\r\n    );\r\n    \r\n    return 0;\r\n}","language":"cpp","kind":"code"},{"code":"; 线程等待并发关系\r\n(call_expression) @concurrency.relationship.thread.wait\r\n  function: (identifier) @thread.wait.function\r\n  (#match? @thread.wait.function \"^(pthread_join)$\")\r\n  arguments: (argument_list\r\n    (identifier) @thread.handle\r\n    (identifier)? @thread.return.value)\r\n\r\n; 线程分离并发关系\r\n(call_expression) @concurrency.relationship.thread.detach\r\n  function: (identifier) @thread.detach.function\r\n  (#match? @thread.detach.function \"^(pthread_detach)$\")\r\n  arguments: (argument_list\r\n    (identifier) @thread.handle)\r\n\r\n; 线程退出并发关系\r\n(call_expression) @concurrency.relationship.thread.exit\r\n  function: (identifier) @thread.exit.function\r\n  (#match? @thread.exit.function \"^(pthread_exit)$\")\r\n  arguments: (argument_list\r\n    (identifier)? @thread.exit.value)\r\n\r\n; 获取线程ID并发关系\r\n(call_expression) @concurrency.relationship.thread.id\r\n  function: (identifier) @thread.id.function\r\n  (#match? @thread.id.function \"^(pthread_self)$\")\r\n  arguments: (argument_list)\r\n\r\n; 互斥锁相关的同步关系 - 合并为单一查询 to improve efficiency\r\n(call_expression) @concurrency.relationship.mutex.operation\r\n  function: (identifier) @mutex.operation.function\r\n  (#match? @mutex.operation.function \"^(pthread_mutex_lock|pthread_mutex_trylock|pthread_mutex_unlock|pthread_mutex_destroy)$\")\r\n  [\r\n    (argument_list\r\n      (pointer_expression argument: (identifier) @mutex.handle)\r\n      (identifier)? @mutex.attributes)\r\n    (argument_list\r\n      (pointer_expression argument: (identifier) @mutex.handle))\r\n  ]\r\n\r\n; 条件变量相关的同步关系 - 合并为单一查询 to improve efficiency\r\n(call_expression) @concurrency.relationship.condition.operation\r\n  function: (identifier) @cond.operation.function\r\n  (#match? @cond.operation.function \"^(pthread_cond_wait|pthread_cond_timedwait|pthread_cond_signal|pthread_cond_broadcast|pthread_cond_destroy)$\")\r\n  [\r\n    (argument_list\r\n      (pointer_expression argument: (identifier) @cond.handle)\r\n      (identifier)? @cond.attributes)\r\n    (argument_list\r\n      (pointer_expression argument: (identifier) @cond.handle)\r\n      (pointer_expression argument: (identifier) @mutex.handle))\r\n    (argument_list\r\n      (pointer_expression argument: (identifier) @cond.handle))\r\n  ]\r\n\r\n; 读写锁相关的同步关系 - 合并为单一查询 to improve efficiency\r\n(call_expression) @concurrency.relationship.rwlock.operation\r\n  function: (identifier) @rwlock.operation.function\r\n  (#match? @rwlock.operation.function \"^(pthread_rwlock_rdlock|pthread_rwlock_wrlock|pthread_rwlock_unlock|pthread_rwlock_destroy)$\")\r\n  [\r\n    (argument_list\r\n      (pointer_expression argument: (identifier) @rwlock.handle)\r\n      (identifier)? @rwlock.attributes)\r\n    (argument_list\r\n      (pointer_expression argument: (identifier) @rwlock.handle))\r\n  ]\r\n\r\n; 信号量相关的同步关系 - 合并为单一查询 to improve efficiency\r\n(call_expression) @concurrency.relationship.semaphore.operation\r\n  function: (identifier) @semaphore.operation.function\r\n  (#match? @semaphore.operation.function \"^(sem_wait|sem_trywait|sem_post|sem_destroy)$\")\r\n  [\r\n    (argument_list\r\n      (pointer_expression argument: (identifier) @semaphore.handle)\r\n      (identifier) @semaphore.pshared\r\n      (identifier) @semaphore.value)\r\n    (argument_list\r\n      (pointer_expression argument: (identifier) @semaphore.handle))\r\n  ]\r\n\r\n; 内存和编译器屏障并发关系 - 合并为单一查询 to improve efficiency\r\n(call_expression) @concurrency.relationship.barrier.operation\r\n  function: (identifier) @barrier.operation.function\r\n  (#match? @barrier.operation.function \"^(atomic_thread_fence|__atomic_thread_fence|__sync_synchronize)$\")\r\n  arguments: (argument_list\r\n    (identifier)? @memory.order)\r\n\r\n; 线程本地变量声明\r\n(declaration\r\n  (storage_class_specifier) @thread.local.specifier\r\n  (#match? @thread.local.specifier \"^(__thread|_Thread_local)$\")\r\n  type: (primitive_type) @thread.local.type\r\n  declarator: (identifier) @thread.local.variable) @concurrency.relationship.thread.local","language":"scm","kind":"code"}]}