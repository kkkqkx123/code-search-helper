{"cells":[{"code":"#include <atomic>\r\n#include <memory>\r\n\r\ntemplate<typename T>\r\nclass LockFreeStack {\r\nprivate:\r\n    struct Node {\r\n        T data;\r\n        std::atomic<Node*> next;\r\n        \r\n        Node(T const& data_) : data(data_) {}\r\n    };\r\n    \r\n    std::atomic<Node*> head;\r\n    \r\npublic:\r\n    void push(T const& data) {\r\n        Node* new_node = new Node(data);\r\n        new_node->next = head.load();\r\n        while(!head.compare_exchange_weak(new_node->next, new_node));\r\n    }\r\n};\r\n\r\nint main() {\r\n    LockFreeStack<int> stack;\r\n    stack.push(1);\r\n    stack.push(2);\r\n    return 0;\r\n}","language":"cpp","kind":"code"},{"code":"(class_specifier\r\n  name: (type_identifier) @lockfree.class\r\n  body: (field_declaration_list\r\n    (field_declaration\r\n      type: (qualified_identifier\r\n        scope: (identifier) @std.scope\r\n        name: (type_identifier) @atomic.type)\r\n      declarator: (field_declarator\r\n        declarator: (field_identifier) @atomic.field)))) @concurrency.relationship.lockfree.structure","language":"scm","kind":"code"}]}