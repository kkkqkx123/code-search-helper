{"cells":[{"code":"#include <atomic>\r\n#include <thread>\r\n#include <iostream>\r\n\r\nstd::atomic_flag flag = ATOMIC_FLAG_INIT;\r\n\r\nvoid trySetFlag() {\r\n    if (!flag.test_and_set()) {\r\n        std::cout << \"Flag was unset, now set\" << std::endl;\r\n    } else {\r\n        std::cout << \"Flag was already set\" << std::endl;\r\n    }\r\n}\r\n\r\nvoid clearFlag() {\r\n    flag.clear();\r\n    std::cout << \"Flag cleared\" << std::endl;\r\n}\r\n\r\nint main() {\r\n    std::thread t1(trySetFlag);\r\n    std::thread t2(trySetFlag);\r\n    std::thread t3(clearFlag);\r\n    \r\n    t1.join();\r\n    t2.join();\r\n    t3.join();\r\n    \r\n    return 0;\r\n}","language":"cpp","kind":"code"},{"code":"(call_expression\r\n  function: (field_expression\r\n    (identifier) @atomic.flag\r\n    (field_identifier) @flag.method)\r\n  (#match? @flag.method \"^(test_and_set|clear)$\"))@concurrency.relationship.atomic.flag","language":"scm","kind":"code"}]}